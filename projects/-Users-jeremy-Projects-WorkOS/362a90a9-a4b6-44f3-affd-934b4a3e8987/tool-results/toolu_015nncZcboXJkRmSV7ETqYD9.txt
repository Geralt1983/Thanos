     1→import { neon } from "@neondatabase/serverless"
     2→import { drizzle } from "drizzle-orm/neon-http"
     3→import * as schema from "./schema"
     4→
     5→let cachedDb: ReturnType<typeof drizzle> | null = null
     6→
     7→export function getDb() {
     8→  if (cachedDb) return cachedDb
     9→
    10→  const url = process.env.DATABASE_URL
    11→  if (!url) {
    12→    console.error("[v0] DATABASE_URL is not set")
    13→    throw new Error("DATABASE_URL environment variable is not set")
    14→  }
    15→
    16→  console.log("[v0] Initializing database connection")
    17→
    18→  // Clean up common copy-paste mistakes
    19→  let connectionString = url.trim()
    20→  if (connectionString.startsWith("psql ")) {
    21→    connectionString = connectionString.replace(/^psql\s+['"]?/, "").replace(/['"]?\s*$/, "")
    22→  }
    23→
    24→  try {
    25→    const sql = neon(connectionString)
    26→    cachedDb = drizzle(sql, { schema })
    27→    console.log("[v0] Database connection initialized successfully")
    28→    return cachedDb
    29→  } catch (error) {
    30→    console.error("[v0] Failed to initialize database:", error)
    31→    throw error
    32→  }
    33→}
    34→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
